<div dir="rtl">

# לא רלציוני ולא במקרה

## למה לבחור בדאטה בייס לא רלציוני?

- ✅ **גמישות מבנית** – אין צורך להגדיר סכמות קשיחות מראש. ניתן להוסיף או לשנות שדות ללא מיגרציות.  
- 🚀 **התאמה לתצוגה** – אפשר לשמור את המידע כפי שהוא מוצג בפרונט.  
- ⚡ **ביצועים גבוהים** – שליפות פשוטות יכולות להיות מהירות מאוד אם הדאטה מאורגן נכון.  

## אז איך מארגנים נכון?

ב־Database לא רלציוני חשוב להבין מתי **לקנן (nest)** מידע בתוך מסמך ומתי **לפתוח collection נפרד**.

| מתי לקנן?                  | מתי לפתוח collection נפרד?     |
|---------------------------|--------------------------------|
| המידע לא קריטי בפני עצמו | המידע גדל ללא שליטה            |
| רק לצורך תצוגה מיידית     | צריך חיפושים עליו              |
| לא ניגשים אליו בנפרד      | מקושר לישויות אחרות            |

### דוגמה: מערכת פוסטים ותגובות

```json
{
  "_id": ObjectId("64ef1a2a4f1c2b6a7e8d1234"),
  "authorId": ObjectId("64ef1b3c9d8e4f2c6a7b5678"),
  "text": "היום היה לי יום טוב!",
  "comments": [
    {
      "commentId": ObjectId("64ef1f3a5c9a4a1b9d7c8765"),
      "userId": ObjectId("64ef1e9a3c4e8f2c7a6d9087"),
      "text": "שמחים לשמוע!",
      "likes": 4
    }
  ]
}
```

אם נוסיף לייקים לתגובה, נרצה לפצל ל־collection נפרד:

```json
{
  "_id": ObjectId("64ef1f3a5c9a4a1b9d7c8765"),
  "postId": ObjectId("64ef1a2a4f1c2b6a7e8d1234"),
  "userId": ObjectId("64ef1e9a3c4e8f2c7a6d9087"),
  "text": "שמחים לשמוע!",
  "likes": [ObjectId("64ef1d9a7c6e4a1f8b9c4321"), ObjectId("64ef1c2a8b7f5e3d6a4c7890")]
}
```

### איך להימנע מ־Lookup?

```json
{
  "userId": ObjectId("64ef1e9a3c4e8f2c7a6d9087"),
  "userName": "רוני לוי",
  "userImg": "https://cdn.com/u456.jpg"
}
```

כאן אנחנו עושים **דה־נורמליזציה** – שיטה פחות אלגנטית אך יעילה לתצוגה.

**⚠️ הימנעו משכפול מידע רגיש** כמו מייל או role.

### ומה לגבי עדכניות?

כן, זו פשרה. אבל לפעמים שווה לוותר על עדכניות תמורת ביצועים טובים ונוחות בפרונט.

אנחנו לא מחויבים לעדכן את כל המופעים של המידע. לדוגמה, אם משתמש מחליף תמונת פרופיל, לא נרוץ לעדכן 10,000 תגובות.

עדכניות תוחלף באמינות: נעדכן רק את מקור האמת ונשכפל רק את מה שדרוש להצגה.

### מתי כן נדרש Lookup?

```js
{
  $lookup: {
    from: 'users',
    localField: 'userId',
    foreignField: '_id',
    as: 'userData'
  }
}
```

אם נדרש מידע נוסף שלא שוכפל – אין ברירה אלא לעשות lookup.

זה לא אסון – אבל זו לא צריכה להיות ברירת מחדל.

### שיקולי אבטחה

- ❌ אל תשכפלו סיסמאות, מיילים, roles.
- ✅ כן לשכפל שם משתמש, תמונת פרופיל, timestamp.

**דה־נורמליזציה צריכה להיות גרנולרית, לא גנרית.**

אם כבר משכפלים — לעולם לא נכלול מידע חיוני לאבטחה כמו מזהי הרשאות, סיסמאות או פרטים מזהים עמוקים.

## לסיכום:

- 🧠 חשוב לפי תצוגה, לא לפי סכמות.
- 🛑 המנע מ־lookup כשאפשר.
- 🧱 עשה דה־נורמליזציה בזהירות.
- 🔐 הגן על מידע רגיש גם אם הוא מופיע בפרונט.

</div>
